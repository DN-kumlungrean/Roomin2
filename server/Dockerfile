FROM node:24-alpine
WORKDIR /app

COPY package*.json ./
RUN npm install

COPY prisma ./prisma
RUN npx prisma generate

COPY . .
COPY .env .env

EXPOSE 3000
CMD ["npm", "run", "dev"]

# FROM node:20-alpine AS builder

# WORKDIR /app
# COPY package*.json ./

# # ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á Prisma CLI)
# RUN npm install 

# # ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ã‡∏≠‡∏£‡πå‡∏™‡πÇ‡∏Ñ‡πâ‡∏î ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á Build (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
# COPY . .
# # üí° ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏™‡∏±‡πà‡∏á Prisma Generate ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Prisma Client
# RUN npx prisma generate

# # Stage 2: Production - Image ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á
# FROM node:20-slim

# WORKDIR /app

# # üí° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Path COPY ‡πÉ‡∏ô Stage 2 ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô Stage 1
# COPY --from=builder /app/node_modules ./node_modules

# # ‡πÇ‡∏Ñ‡πâ‡∏î Backend ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå 'backend'
# COPY --from=builder /app/backend/controllers ./controllers 
# COPY --from=builder /app/backend/config ./config 
# COPY --from=builder /app/backend/routers ./routers
# COPY --from=builder /app/app.js .

# # ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏≠‡∏∑‡πà‡∏ô‡πÜ
# COPY --from=builder /app/package.json .
# COPY --from=builder /app/prisma ./prisma 

# # ‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ó‡∏µ‡πà Server API ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ü‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà (‡πÄ‡∏ä‡πà‡∏ô Express/NestJS)
# EXPOSE 3000

# # ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏±‡∏ô Production Server
# CMD ["npm", "start"]